/*
 * lzbase62 - LZ77(LZSS) based compression algorithm in base62 for JavaScript.
 * @version 1.4.1
 * @copyright Copyright (c) 2014 polygon planet <polygon.planet.aqua@gmail.com>
 * @license Licensed under the MIT license.
 */
(function(h,m,k){"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=k():exports[h]=k():"function"===typeof define&&define.amd?define(k):m[h]=k()})("lzbase62",this,function(){"use strict";function h(a){this._init(a)}function m(a){this._init(a)}function k(){var a="",b,c,d,f;for(b=0;26>b;b++)for(d="abcdefghijklmnopqrstuvwxyz".charAt(b),c=25;15<c&&1024>a.length;c--)f="abcdefghijklmnopqrstuvwxyz".charAt(c),a+=" "+d+" "+f;for(;1024>a.length;)a=" "+a;return a=a.slice(0,1024)}function v(a,
b){if(a.length===b)return a;if(a.subarray)return a.subarray(0,b);a.length=b;return a}function p(a,b){if(!q)return Array(b);switch(a){case 8:return new Uint8Array(b);case 16:return new Uint16Array(b)}}var l=String.fromCharCode,q="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array,r=!1,s=!1;try{"a"===l.apply(null,[97])&&(r=!0)}catch(x){}if(q)try{"a"===l.apply(null,new Uint8Array([97]))&&(s=!0)}catch(y){}var t=Math.max(62,62)-Math.min(62,62),w=t+20,u=62-t-19;h.prototype={_init:function(a){a||
(a={});this._result=this._table=this._data=null;this._onDataCallback=a.onData;this._onEndCallback=a.onEnd},_createTable:function(){for(var a=p(8,62),b=0;62>b;b++)a[b]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charCodeAt(b);return a},_onData:function(a,b){var c;a:{if(r&&s&&65533>b)try{c=l.apply(null,v(a,b));break a}catch(d){}c="";for(var f=0;f<b;f++)c+=l(a[f])}this._onDataCallback?this._onDataCallback(c):this._result+=c},_onEnd:function(){this._onEndCallback&&this._onEndCallback();
this._data=this._table=null},_search:function(){var a=2,b=this._data,c=this._offset,d=61;this._dataLen-c<d&&(d=this._dataLen-c);if(a>d)return!1;var f=c-304,e=b.substring(f,c+d),g=c+a-3-f,k,h,l,n,m;do{if(2===a){if(h=b.charAt(c)+b.charAt(c+1),l=e.indexOf(h),!~l||l>g)break}else h=3===a?h+b.charAt(c+2):b.substr(c,a);n=e.lastIndexOf(h,g);if(!~n)break;m=n;k=f+n;do if(b.charCodeAt(c+a)!==b.charCodeAt(k+a))break;while(++a<d);if(l===n){a++;break}}while(++a<d);if(2===a)return!1;this._index=304-m;this._length=
a-1;return!0},compress:function(a){if(null==a||0===a.length)return"";var b="",b=this._createTable(),c=k(),d=p(8,65533),f=0;this._result="";this._offset=c.length;this._data=c+a;this._dataLen=this._data.length;var e=-1;a=-1;for(var g;this._offset<this._dataLen;)this._search()?(61>this._index?(c=this._index,e=0):(c=this._index%61,e=(this._index-c)/61),2===this._length?(d[f++]=b[e+54],d[f++]=b[c]):(d[f++]=b[e+49],d[f++]=b[c],d[f++]=b[this._length]),this._offset+=this._length,~a&&(a=-1)):(e=this._data.charCodeAt(this._offset++),
132>e?(40>e?(c=e,e=63):(c=e%40,e=(e-c)/40,e+=63),a===e?d[f++]=b[c]:(d[f++]=b[e-w],d[f++]=b[c],a=e)):(1640>e?(c=e,e=67):(c=e%1640,e=(e-c)/1640,e+=67),40>c?(g=c,c=0):(g=c%40,c=(c-g)/40),a===e?(d[f++]=b[g],d[f++]=b[c]):(d[f++]=b[48],d[f++]=b[e-62],d[f++]=b[g],d[f++]=b[c],a=e))),65471<=f&&(this._onData(d,f),f=0);0<f&&this._onData(d,f);this._onEnd();b=this._result;this._result=null;return null===b?"":b}};m.prototype={_init:function(a){a||(a={});this._result=null;this._onDataCallback=a.onData;this._onEndCallback=
a.onEnd},_createTable:function(){for(var a={},b=0;62>b;b++)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(b)]=b;return a},_onData:function(a){this._onDataCallback&&(a?(a=this._result,this._result=null):(a=this._result.substr(1024,64509),this._result=this._result.slice(0,1024)+this._result.substring(65533)),0<a.length&&this._onDataCallback(a))},_onEnd:function(){this._onEndCallback&&this._onEndCallback()},decompress:function(a){if(null==a||0===a.length)return"";this._result=
k();for(var b="",b=this._createTable(),c=!1,d=null,f=a.length,e=0,g,h;e<f;e++){g=b[a.charAt(e)];if(void 0===g)throw Error("Out of range in decompression");if(g<u)c?(h=b[a.charAt(++e)],g=40*h+g+1640*d):g=40*d+g,this._result+=l(g);else if(47>g)d=g-u,c=!1;else if(48===g)d=b[a.charAt(++e)],d-=5,c=!0;else if(59>g){d=b[a.charAt(++e)];54>g?(g=61*(g-49)+d,d=b[a.charAt(++e)]):(g=61*(g-54)+d,d=2);if(h=this._result.slice(-304).slice(-g).substring(0,d)){for(g="";g.length<d;)g+=h;this._result+=g.substring(0,d)}d=
null}67581<=this._result.length&&this._onData()}this._result=this._result.substring(1024);this._onData(!0);this._onEnd();b=this._result;this._result=null;return null===b?"":b}};return{compress:function(a,b){return(new h(b)).compress(a)},decompress:function(a,b){return(new m(b)).decompress(a)}}});
